# Há»† THá»NG THI TRáº®C NGHIá»†M - TECHNICAL DOCUMENTATION

## ğŸ“‹ Tá»”NG QUAN Dá»± ÃN

**TÃªn dá»± Ã¡n**: Smart Test - Há»‡ thá»‘ng thi tráº¯c nghiá»‡m thÃ´ng minh  
**Kiáº¿n trÃºc**: Client-Server (Flutter Mobile App + ASP.NET Core Web API)  
**Má»¥c Ä‘Ã­ch**: Quáº£n lÃ½ vÃ  thá»±c hiá»‡n cÃ¡c bÃ i thi tráº¯c nghiá»‡m trá»±c tuyáº¿n

---

## ğŸ—ï¸ KIáº¾N TRÃšC Tá»”NG THá»‚

### 1. Backend - ThiTracNghiemApi (.NET 9.0)
- **Framework**: ASP.NET Core Web API
- **Database**: SQL Server (Entity Framework Core)
- **Authentication**: JWT Bearer Token + Google OAuth2
- **Architecture Pattern**: MVC vá»›i Repository Pattern

### 2. Frontend - thitracnghiemapp (Flutter)
- **Framework**: Flutter (Dart)
- **State Management**: Provider Pattern
- **UI Framework**: Material Design 3
- **Platform Support**: Android, iOS, Web, Windows, macOS, Linux

---

## ğŸ“‚ Cáº¤U TRÃšC THÆ¯ Má»¤C CHI TIáº¾T

### BACKEND STRUCTURE

```
ThiTracNghiemApi/
â”‚
â”œâ”€â”€ Controllers/              # API Endpoints
â”‚   â”œâ”€â”€ AuthController.cs    # ÄÄƒng nháº­p, Ä‘Äƒng kÃ½, 2FA, forgot password
â”‚   â”œâ”€â”€ UsersController.cs   # Quáº£n lÃ½ ngÆ°á»i dÃ¹ng (Admin)
â”‚   â”œâ”€â”€ ChuDeController.cs   # CRUD chá»§ Ä‘á»
â”‚   â”œâ”€â”€ CauHoiController.cs  # CRUD cÃ¢u há»i, import Excel
â”‚   â”œâ”€â”€ DeThiController.cs   # CRUD Ä‘á» thi
â”‚   â”œâ”€â”€ ThiController.cs     # Thá»±c hiá»‡n bÃ i thi
â”‚   â”œâ”€â”€ KetQuaThiController.cs # Xem káº¿t quáº£ thi
â”‚   â”œâ”€â”€ BinhLuanController.cs  # Comment há»‡ thá»‘ng
â”‚   â”œâ”€â”€ ChatController.cs      # Chat real-time (planned)
â”‚   â””â”€â”€ LienHeController.cs    # LiÃªn há»‡/Feedback
â”‚
â”œâ”€â”€ Models/                   # Database Entities
â”‚   â”œâ”€â”€ ApplicationUser.cs   # User (káº¿ thá»«a IdentityUser)
â”‚   â”œâ”€â”€ ChuDe.cs            # Topic/Category
â”‚   â”œâ”€â”€ CauHoi.cs           # Question
â”‚   â”œâ”€â”€ DeThi.cs            # Exam
â”‚   â”œâ”€â”€ KetQuaThi.cs        # Exam Result
â”‚   â”œâ”€â”€ ChiTietKetQuaThi.cs # Result Detail (per question)
â”‚   â”œâ”€â”€ BinhLuan.cs         # Comment
â”‚   â””â”€â”€ LienHe.cs           # Contact Message
â”‚
â”œâ”€â”€ Dtos/                    # Data Transfer Objects
â”‚   â”œâ”€â”€ Auth/               # Login, Register, Reset Password
â”‚   â”œâ”€â”€ Users/              # User Management DTOs
â”‚   â”œâ”€â”€ CauHoi/             # Question DTOs, Import
â”‚   â”œâ”€â”€ Thi/                # Exam Submission DTOs
â”‚   â”œâ”€â”€ BinhLuan/           # Comment DTOs
â”‚   â”œâ”€â”€ Chat/               # Chat Message DTOs
â”‚   â””â”€â”€ LienHe/             # Contact DTOs
â”‚
â”œâ”€â”€ Data/
â”‚   â””â”€â”€ ApplicationDbContext.cs  # EF Core DbContext
â”‚
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ IEmailSender.cs     # Email Service Interface
â”‚   â””â”€â”€ SmtpEmailSender.cs  # SMTP Email Implementation
â”‚
â”œâ”€â”€ Extensions/
â”‚   â”œâ”€â”€ ClaimsPrincipalExtensions.cs  # Get User ID from Claims
â”‚   â””â”€â”€ UserMappingExtensions.cs      # Entity to DTO mapping
â”‚
â”œâ”€â”€ Options/
â”‚   â””â”€â”€ SmtpOptions.cs      # Email Configuration
â”‚
â”œâ”€â”€ Migrations/             # EF Core Migrations
â”‚   â””â”€â”€ [Migration Files]
â”‚
â”œâ”€â”€ appsettings.json        # App Configuration
â”œâ”€â”€ appsettings.Development.json  # Dev Configuration
â””â”€â”€ Program.cs              # Application Entry Point
```

### FRONTEND STRUCTURE

```
thitracnghiemapp/
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ main.dart           # App Entry Point
â”‚   â”‚
â”‚   â”œâ”€â”€ core/               # Core Utilities
â”‚   â”‚   â”œâ”€â”€ api_client.dart      # HTTP Client Wrapper
â”‚   â”‚   â”œâ”€â”€ api_exception.dart   # Custom Exceptions
â”‚   â”‚   â”œâ”€â”€ token_storage.dart   # Secure Token Storage
â”‚   â”‚   â””â”€â”€ app_env.dart         # Environment Variables
â”‚   â”‚
â”‚   â”œâ”€â”€ models/             # Data Models (Mirror Backend)
â”‚   â”‚   â”œâ”€â”€ user.dart
â”‚   â”‚   â”œâ”€â”€ chu_de.dart
â”‚   â”‚   â”œâ”€â”€ cau_hoi.dart
â”‚   â”‚   â”œâ”€â”€ de_thi.dart
â”‚   â”‚   â”œâ”€â”€ ket_qua_thi.dart
â”‚   â”‚   â”œâ”€â”€ binh_luan.dart
â”‚   â”‚   â”œâ”€â”€ lien_he.dart
â”‚   â”‚   â”œâ”€â”€ auth_response.dart
â”‚   â”‚   â””â”€â”€ two_fa.dart
â”‚   â”‚
â”‚   â”œâ”€â”€ providers/          # State Management (Provider Pattern)
â”‚   â”‚   â”œâ”€â”€ auth_provider.dart        # Authentication State
â”‚   â”‚   â”œâ”€â”€ users_provider.dart       # User Management
â”‚   â”‚   â”œâ”€â”€ chu_de_provider.dart      # Topics
â”‚   â”‚   â”œâ”€â”€ cau_hoi_provider.dart     # Questions
â”‚   â”‚   â”œâ”€â”€ de_thi_provider.dart      # Exams
â”‚   â”‚   â”œâ”€â”€ thi_provider.dart         # Take Exam State
â”‚   â”‚   â”œâ”€â”€ ket_qua_thi_provider.dart # Results
â”‚   â”‚   â”œâ”€â”€ binh_luan_provider.dart   # Comments
â”‚   â”‚   â”œâ”€â”€ chat_provider.dart        # Chat
â”‚   â”‚   â””â”€â”€ lien_he_provider.dart     # Contact
â”‚   â”‚
â”‚   â”œâ”€â”€ services/           # API Service Layer
â”‚   â”‚   â”œâ”€â”€ auth_service.dart
â”‚   â”‚   â”œâ”€â”€ users_service.dart
â”‚   â”‚   â”œâ”€â”€ chu_de_service.dart
â”‚   â”‚   â”œâ”€â”€ cau_hoi_service.dart
â”‚   â”‚   â”œâ”€â”€ de_thi_service.dart
â”‚   â”‚   â”œâ”€â”€ thi_service.dart
â”‚   â”‚   â”œâ”€â”€ ket_qua_thi_service.dart
â”‚   â”‚   â”œâ”€â”€ binh_luan_service.dart
â”‚   â”‚   â”œâ”€â”€ chat_service.dart
â”‚   â”‚   â””â”€â”€ lien_he_service.dart
â”‚   â”‚
â”‚   â”œâ”€â”€ screens/            # UI Screens
â”‚   â”‚   â”œâ”€â”€ splash_screen.dart          # Splash Screen
â”‚   â”‚   â”œâ”€â”€ login_screen.dart           # Login
â”‚   â”‚   â”œâ”€â”€ register_screen.dart        # Register
â”‚   â”‚   â”œâ”€â”€ forgot_password_screen.dart # Forgot Password
â”‚   â”‚   â”œâ”€â”€ two_fa_login_screen.dart    # 2FA Verification
â”‚   â”‚   â”œâ”€â”€ home_screen.dart            # Main Dashboard
â”‚   â”‚   â”œâ”€â”€ quiz_screen.dart            # Take Exam
â”‚   â”‚   â”œâ”€â”€ result_screen.dart          # View Result
â”‚   â”‚   â”œâ”€â”€ profile_screen.dart         # User Profile
â”‚   â”‚   â”œâ”€â”€ contact_screen.dart         # Contact Form
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â””â”€â”€ admin_dashboard_screen.dart  # Admin Panel
â”‚   â”‚
â”‚   â”œâ”€â”€ themes/
â”‚   â”‚   â””â”€â”€ app_theme.dart  # Material Design Theme
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ ui_helpers.dart # UI Constants & Helpers
â”‚
â”œâ”€â”€ assets/                 # Static Assets
â”‚   â”œâ”€â”€ quizlogo.png       # App Logo
â”‚   â”œâ”€â”€ Splash_Screen.png  # Splash Image
â”‚   â””â”€â”€ app_icon.png       # App Icon
â”‚
â”œâ”€â”€ android/               # Android Native Code
â”œâ”€â”€ ios/                   # iOS Native Code
â”œâ”€â”€ web/                   # Web Configuration
â”œâ”€â”€ windows/               # Windows Native Code
â”œâ”€â”€ linux/                 # Linux Native Code
â”œâ”€â”€ macos/                 # macOS Native Code
â”‚
â”œâ”€â”€ .env                   # Environment Variables (API URL, etc.)
â”œâ”€â”€ pubspec.yaml           # Dependencies & Assets
â””â”€â”€ README.md
```

---

## ğŸ”„ LUá»’NG HOáº T Äá»˜NG CHI TIáº¾T

### 1. KHá»I Äá»˜NG á»¨NG Dá»¤NG

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. App Start (main.dart)                                â”‚
â”‚    - Load .env configuration                            â”‚
â”‚    - Initialize ApiClient with BASE_URL                 â”‚
â”‚    - Initialize TokenStorage                            â”‚
â”‚    - Create Provider instances                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Splash Screen Display                                â”‚
â”‚    - Show Splash_Screen.png                             â”‚
â”‚    - CircularProgressIndicator                          â”‚
â”‚    - "Äang táº£i á»©ng dá»¥ng..."                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. AuthProvider.initialize()                            â”‚
â”‚    - Read stored JWT token from TokenStorage            â”‚
â”‚    - Check if token exists and not expired             â”‚
â”‚    - If valid: Fetch fresh user profile from API       â”‚
â”‚    - If invalid: Clear storage                         â”‚
â”‚    - Minimum 2s delay for splash screen                â”‚
â”‚    - Set isInitialized = true                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚               â”‚
            Token Valid?    Token Invalid/Expired
                  â”‚               â”‚
                  â†“               â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Home Screen â”‚  â”‚ Login Screen â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. LUá»’NG ÄÄ‚NG NHáº¬P (AUTHENTICATION FLOW)

#### A. ÄÄƒng nháº­p thÆ°á»ng (Username/Password)

```
User Input Credentials
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. LoginScreen                          â”‚
â”‚    - Validate form (username, password) â”‚
â”‚    - Call AuthProvider.login()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. AuthProvider.login()                 â”‚
â”‚    - Call AuthService.loginRaw()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. AuthService â†’ API POST /auth/login  â”‚
â”‚    Body: { identifier, password }      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Backend: AuthController.Login()     â”‚
â”‚    - Find user by username/email        â”‚
â”‚    - Verify password                    â”‚
â”‚    - Check if 2FA enabled              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
2FA ON?    2FA OFF
    â”‚         â”‚
    â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return  â”‚  â”‚ Generate JWT Token   â”‚
â”‚ { req-  â”‚  â”‚ Return AuthResponse: â”‚
â”‚ uires   â”‚  â”‚ - token              â”‚
â”‚ TwoF-   â”‚  â”‚ - user               â”‚
â”‚ actor:  â”‚  â”‚ - expiresAt          â”‚
â”‚ true,   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ userId  â”‚            â†“
â”‚ }       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ 5. Client Receives   â”‚
    â†“        â”‚    - Save token to   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      TokenStorage    â”‚
â”‚Navigate â”‚  â”‚    - Set currentUser â”‚
â”‚to 2FA   â”‚  â”‚    - Navigate to     â”‚
â”‚Screen   â”‚  â”‚      HomeScreen      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### B. ÄÄƒng nháº­p Google OAuth

```
User Taps "ÄÄƒng nháº­p vá»›i Google"
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. LoginScreen._loginWithGoogle()      â”‚
â”‚    - Initialize GoogleSignIn            â”‚
â”‚    - Sign out previous session          â”‚
â”‚    - Trigger Google Sign-In flow        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Google OAuth Web View               â”‚
â”‚    - User selects Google account        â”‚
â”‚    - Grant permissions                  â”‚
â”‚    - Return idToken                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Call AuthProvider.loginWithGoogle() â”‚
â”‚    - Send idToken to backend            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Backend: AuthController.Google()    â”‚
â”‚    - Verify idToken with Google         â”‚
â”‚    - Extract email from Google profile  â”‚
â”‚    - Find or create user                â”‚
â”‚    - Generate JWT token                 â”‚
â”‚    - Return AuthResponse                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Save token & Navigate to Home       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### C. XÃ¡c thá»±c 2 yáº¿u tá»‘ (2FA)

```
After Login with 2FA enabled
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. TwoFaLoginScreen                     â”‚
â”‚    - Enter 6-digit code from email      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. POST /auth/verify-2fa                â”‚
â”‚    Body: { userId, code }               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Backend Verify Code                  â”‚
â”‚    - Check code matches & not expired   â”‚
â”‚    - Generate JWT token                 â”‚
â”‚    - Return AuthResponse                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Login success, navigate to Home     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. LUá»’NG Láº¤Y Dá»® LIá»†U (DATA FETCHING FLOW)

```
Screen Mounted (e.g., HomeScreen)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Consumer<Provider> widget           â”‚
â”‚    - Listen to Provider changes         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Provider.fetchData()                 â”‚
â”‚    - Set isLoading = true               â”‚
â”‚    - Call Service method                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Service â†’ API GET request           â”‚
â”‚    - Add JWT token to headers           â”‚
â”‚    - Send HTTP request                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Backend Controller                   â”‚
â”‚    - Verify JWT token                   â”‚
â”‚    - Check authorization                â”‚
â”‚    - Query database via EF Core         â”‚
â”‚    - Return JSON data                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Service parses JSON                  â”‚
â”‚    - Convert to Model objects           â”‚
â”‚    - Return to Provider                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Provider updates state               â”‚
â”‚    - Store data in memory               â”‚
â”‚    - Set isLoading = false              â”‚
â”‚    - notifyListeners()                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. UI Rebuilds                          â”‚
â”‚    - Display data in widgets            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. LUá»’NG THI (EXAM TAKING FLOW)

```
User selects exam from list
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. HomeScreen - Tap exam card           â”‚
â”‚    - Navigate to QuizScreen             â”‚
â”‚    - Pass DeThi object                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. QuizScreen.initState()               â”‚
â”‚    - Call ThiProvider.startExam()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ThiProvider.startExam()              â”‚
â”‚    - POST /thi/bat-dau                  â”‚
â”‚    - Body: { deThiId }                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Backend: ThiController.BatDauThi()  â”‚
â”‚    - Get random questions from topic    â”‚
â”‚    - Record exam session (KetQuaThi)   â”‚
â”‚    - Start timer (ThoiGianBatDau)      â”‚
â”‚    - Return: sessionId, questions       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. QuizScreen displays questions        â”‚
â”‚    - Show question by question          â”‚
â”‚    - Start countdown timer              â”‚
â”‚    - User selects answers               â”‚
â”‚    - Answers stored in local state      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
User taps "Ná»™p bÃ i" or Timer expires
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ThiProvider.submitExam()             â”‚
â”‚    - POST /thi/nop-bai                  â”‚
â”‚    - Body: { ketQuaThiId, answers[] }   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Backend: ThiController.NopBai()     â”‚
â”‚    - Validate submission time           â”‚
â”‚    - Calculate score (auto-grade)       â”‚
â”‚    - Save ChiTietKetQuaThi records     â”‚
â”‚    - Update KetQuaThi with score        â”‚
â”‚    - Return detailed results            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. Navigate to ResultScreen             â”‚
â”‚    - Show score, correct/wrong answers  â”‚
â”‚    - Show detailed explanation          â”‚
â”‚    - Option to review                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. LUá»’NG ADMIN QUáº¢N LÃ (ADMIN MANAGEMENT FLOW)

#### A. Quáº£n lÃ½ cÃ¢u há»i (Question Management)

```
Admin Dashboard â†’ CÃ¢u há»i Tab
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Load questions                       â”‚
â”‚    - GET /cau-hoi                       â”‚
â”‚    - Display in list with filters       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Actions available:                   â”‚
â”‚    A. Create new question               â”‚
â”‚    B. Edit existing question            â”‚
â”‚    C. Delete question                   â”‚
â”‚    D. Import from Excel                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Option A: Create New
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Show dialog with form                â”‚
â”‚    - Content (Ná»™i dung)                 â”‚
â”‚    - Answer A, B, C, D                  â”‚
â”‚    - Correct answer                     â”‚
â”‚    - Topic (Chá»§ Ä‘á»)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. POST /cau-hoi                        â”‚
â”‚    - Validate all fields                â”‚
â”‚    - Save to database                   â”‚
â”‚    - Return created question            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Refresh question list                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Option D: Import from Excel
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Select topic for import              â”‚
â”‚    - Dropdown: Chá»§ Ä‘á» Excel             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Tap "Import Excel" button            â”‚
â”‚    - FilePicker opens (.xlsx only)      â”‚
â”‚    - User selects file                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. POST /cau-hoi/import-excel           â”‚
â”‚    - Multipart/form-data upload         â”‚
â”‚    - Body: file + topicId               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Backend: CauHoiController.Import()  â”‚
â”‚    - Read Excel file (EPPlus library)   â”‚
â”‚    - Validate each row                  â”‚
â”‚    - Bulk insert to database            â”‚
â”‚    - Return success count               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Show success message                 â”‚
â”‚    "ÄÃ£ import X cÃ¢u há»i thÃ nh cÃ´ng"    â”‚
â”‚    - Refresh question list              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### B. Quáº£n lÃ½ Ä‘á» thi (Exam Management)

```
Admin Dashboard â†’ Äá» thi Tab
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Create Exam Dialog                   â”‚
â”‚    - TÃªn Ä‘á» thi                         â”‚
â”‚    - Chá»§ Ä‘á» (select)                    â”‚
â”‚    - Sá»‘ cÃ¢u há»i                         â”‚
â”‚    - Thá»i gian thi (phÃºt)               â”‚
â”‚    - Tráº¡ng thÃ¡i (Má»Ÿ/ÄÃ³ng)               â”‚
â”‚    - Cho phÃ©p thi nhiá»u láº§n?            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Validate constraints                 â”‚
â”‚    - Check topic has enough questions   â”‚
â”‚    - soCauHoi <= available questions    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. POST /de-thi                         â”‚
â”‚    - Save exam template                 â”‚
â”‚    - No actual questions stored yet     â”‚
â”‚    - Questions randomized on exam start â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### C. Quáº£n lÃ½ ngÆ°á»i dÃ¹ng (User Management)

```
Admin Dashboard â†’ NgÆ°á»i dÃ¹ng Tab
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. GET /users?page=1&keyword=...        â”‚
â”‚    - Paginated list of users            â”‚
â”‚    - Search by name/email               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Actions available:                   â”‚
â”‚    - Create new account                 â”‚
â”‚    - Edit roles (User/Admin)            â”‚
â”‚    - Lock/Unlock account                â”‚
â”‚    - Delete user                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Lock/Unlock flow:                    â”‚
â”‚    PATCH /users/{id}/lock               â”‚
â”‚    - Toggle LockoutEnd field            â”‚
â”‚    - If lock: set to 100 years future   â”‚
â”‚    - If unlock: set to null             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. LUá»’NG XEM Káº¾T QUáº¢ (VIEW RESULTS FLOW)

```
User â†’ Profile â†’ Tab "Káº¿t quáº£"
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. KetQuaThiProvider.fetchMyResults()  â”‚
â”‚    - GET /ket-qua-thi                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Backend returns list of results      â”‚
â”‚    - Exam name, score, date, status     â”‚
â”‚    - Sorted by date desc                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Display result cards                 â”‚
â”‚    - Green: Passed                      â”‚
â”‚    - Red: Failed                        â”‚
â”‚    - Tap to view details                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
User taps result card
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. GET /ket-qua-thi/{id}/chi-tiet      â”‚
â”‚    - Fetch detailed answers             â”‚
â”‚    - For each question:                 â”‚
â”‚      * Question content                 â”‚
â”‚      * User's answer                    â”‚
â”‚      * Correct answer                   â”‚
â”‚      * Is correct?                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Navigate to ResultScreen             â”‚
â”‚    - Show question-by-question review   â”‚
â”‚    - Highlight correct/wrong            â”‚
â”‚    - Show explanation (if available)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7. LUá»’NG LIÃŠN Há»†/FEEDBACK (CONTACT FLOW)

```
User â†’ ContactScreen
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Fill contact form                    â”‚
â”‚    - Subject (optional)                 â”‚
â”‚    - Message content                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. POST /lien-he                        â”‚
â”‚    - Body: { noiDung }                  â”‚
â”‚    - User ID from JWT                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Backend: LienHeController.Create()  â”‚
â”‚    - Save to database                   â”‚
â”‚    - TrangThai = "ChuaDoc"              â”‚
â”‚    - NgayGui = now                      â”‚
â”‚    - Optional: Send email to admin      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Admin Dashboard â†’ LiÃªn há»‡ Tab        â”‚
â”‚    - View all messages                  â”‚
â”‚    - Mark as read                       â”‚
â”‚    - Delete messages                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Báº¢O Máº¬T VÃ€ AUTHENTICATION

### JWT Token Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Token Structure:                        â”‚
â”‚                                         â”‚
â”‚ Header:                                 â”‚
â”‚   - alg: "HS256"                        â”‚
â”‚   - typ: "JWT"                          â”‚
â”‚                                         â”‚
â”‚ Payload (Claims):                       â”‚
â”‚   - sub: userId                         â”‚
â”‚   - email: user email                   â”‚
â”‚   - name: user full name                â”‚
â”‚   - role: ["User"] or ["Admin"]         â”‚
â”‚   - exp: expiration timestamp           â”‚
â”‚                                         â”‚
â”‚ Signature:                              â”‚
â”‚   - HMACSHA256(header + payload, key)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Token Lifecycle:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Login Success                        â”‚
â”‚    â†’ Backend generates JWT              â”‚
â”‚    â†’ Returns { token, expiresAt, user } â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Client Stores Token                  â”‚
â”‚    â†’ TokenStorage (flutter_secure_storage) â”‚
â”‚    â†’ Encrypted local storage            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Every API Request                    â”‚
â”‚    â†’ Add header:                        â”‚
â”‚      Authorization: Bearer {token}      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Backend Validates Token              â”‚
â”‚    â†’ Verify signature                   â”‚
â”‚    â†’ Check expiration                   â”‚
â”‚    â†’ Extract user claims                â”‚
â”‚    â†’ Check authorization [Authorize]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
 Valid?    Invalid/Expired
    â”‚         â”‚
    â†“         â†“
 Process   Return 401
 Request   Unauthorized
    â”‚         â”‚
    â”‚         â†“
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    â”‚ Client:     â”‚
    â”‚    â”‚ - Clear     â”‚
    â”‚    â”‚   token     â”‚
    â”‚    â”‚ - Navigate  â”‚
    â”‚    â”‚   to Login  â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
 Success
```

### Authorization Levels

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PUBLIC ENDPOINTS (No auth required):         â”‚
â”‚  - POST /auth/login                          â”‚
â”‚  - POST /auth/register                       â”‚
â”‚  - POST /auth/google                         â”‚
â”‚  - POST /auth/forgot-password                â”‚
â”‚  - POST /auth/reset-password                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER ENDPOINTS [Authorize]:                  â”‚
â”‚  - GET  /de-thi (open exams)                 â”‚
â”‚  - POST /thi/bat-dau                         â”‚
â”‚  - POST /thi/nop-bai                         â”‚
â”‚  - GET  /ket-qua-thi (own results)           â”‚
â”‚  - POST /binh-luan                           â”‚
â”‚  - POST /lien-he                             â”‚
â”‚  - GET  /auth/profile                        â”‚
â”‚  - PUT  /auth/profile                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ADMIN ENDPOINTS [Authorize(Roles="Admin")]:  â”‚
â”‚  - ALL /users/* endpoints                    â”‚
â”‚  - POST /chu-de                              â”‚
â”‚  - PUT  /chu-de/{id}                         â”‚
â”‚  - DELETE /chu-de/{id}                       â”‚
â”‚  - POST /cau-hoi                             â”‚
â”‚  - POST /cau-hoi/import-excel                â”‚
â”‚  - PUT  /cau-hoi/{id}                        â”‚
â”‚  - DELETE /cau-hoi/{id}                      â”‚
â”‚  - POST /de-thi                              â”‚
â”‚  - PUT  /de-thi/{id}                         â”‚
â”‚  - DELETE /de-thi/{id}                       â”‚
â”‚  - GET  /de-thi (all, including closed)      â”‚
â”‚  - GET  /lien-he/admin                       â”‚
â”‚  - DELETE /lien-he/{id}                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ DATABASE SCHEMA

### Entity Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ApplicationUser â”‚ (Identity Framework)
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ Id (PK)         â”‚â”€â”€â”€â”
â”‚ UserName        â”‚   â”‚
â”‚ Email           â”‚   â”‚ 1
â”‚ FullName        â”‚   â”‚
â”‚ TwoFactorEnabledâ”‚   â”‚
â”‚ LockoutEnd      â”‚   â”‚
â”‚ Roles[]         â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚                 â”‚                 â”‚
    â”‚ N               â”‚ N               â”‚ N               â”‚ N
    â†“                 â†“                 â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LienHe  â”‚    â”‚ KetQuaThi    â”‚  â”‚ BinhLuan  â”‚   â”‚ (Creator)â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚  ChuDe   â”‚
â”‚ Id (PK) â”‚    â”‚ Id (PK)      â”‚  â”‚ Id (PK)   â”‚   â”‚  CauHoi  â”‚
â”‚ TaiKhoanâ”‚â†â”€â”€â”€â”‚ TaiKhoanId   â”‚  â”‚ TaiKhoan  â”‚   â”‚  DeThi   â”‚
â”‚  Id (FK)â”‚    â”‚   (FK)       â”‚  â”‚  Id (FK)  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ NoiDung â”‚    â”‚ DeThiId (FK) â”‚  â”‚ NoiDung   â”‚
â”‚ NgayGui â”‚    â”‚ Diem         â”‚  â”‚ NgayTao   â”‚
â”‚ TrangThaiâ”‚   â”‚ ThoiGianBD   â”‚  â”‚ Rating    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ ThoiGianKT   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ TrangThai    â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ 1
                      â†“
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ DeThi        â”‚
               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
               â”‚ Id (PK)      â”‚â”€â”€â”€â”
               â”‚ TenDeThi     â”‚   â”‚
               â”‚ ChuDeId (FK) â”‚   â”‚ 1
               â”‚ SoCauHoi     â”‚   â”‚
               â”‚ ThoiGianThi  â”‚   â”‚
               â”‚ TrangThai    â”‚   â”‚
               â”‚ AllowMultipleâ”‚   â”‚
               â”‚  Attempts    â”‚   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                             â”‚
    â”‚ N                           â”‚ N
    â†“                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChiTietKetQuaThiâ”‚      â”‚ CauHoi           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ Id (PK)         â”‚      â”‚ Id (PK)          â”‚
â”‚ KetQuaThiId(FK) â”‚      â”‚ NoiDung          â”‚
â”‚ CauHoiId (FK)   â”‚â”€â”€â”€â”€â”€â”€â”‚ DapAnA           â”‚
â”‚ DapAnDaChon     â”‚  Nâ†’1 â”‚ DapAnB           â”‚
â”‚ DungSai         â”‚      â”‚ DapAnC (null)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ DapAnD (null)    â”‚
                         â”‚ DapAnDung        â”‚
                         â”‚ ChuDeId (FK)     â”‚
                         â”‚ HinhAnh (null)   â”‚
                         â”‚ AmThanh (null)   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†‘
                                  â”‚ N
                                  â”‚
                                  â”‚ 1
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ ChuDe            â”‚
                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                         â”‚ Id (PK)          â”‚
                         â”‚ TenChuDe         â”‚
                         â”‚ MoTa (null)      â”‚
                         â”‚ NgayTao          â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Constraints

```sql
-- Primary Keys
PK_Users ON ApplicationUser(Id)
PK_ChuDe ON ChuDe(Id)
PK_CauHoi ON CauHoi(Id)
PK_DeThi ON DeThi(Id)
PK_KetQuaThi ON KetQuaThi(Id)
PK_ChiTietKetQuaThi ON ChiTietKetQuaThi(Id)
PK_BinhLuan ON BinhLuan(Id)
PK_LienHe ON LienHe(Id)

-- Foreign Keys with Cascade
FK_CauHoi_ChuDe: CauHoi.ChuDeId â†’ ChuDe.Id
  ON DELETE: Restrict (cannot delete topic with questions)

FK_DeThi_ChuDe: DeThi.ChuDeId â†’ ChuDe.Id
  ON DELETE: Restrict

FK_KetQuaThi_User: KetQuaThi.TaiKhoanId â†’ User.Id
  ON DELETE: Restrict

FK_KetQuaThi_DeThi: KetQuaThi.DeThiId â†’ DeThi.Id
  ON DELETE: Restrict

FK_ChiTietKetQuaThi_KetQuaThi: ChiTietKetQuaThi.KetQuaThiId â†’ KetQuaThi.Id
  ON DELETE: Cascade (delete details when parent deleted)

FK_ChiTietKetQuaThi_CauHoi: ChiTietKetQuaThi.CauHoiId â†’ CauHoi.Id
  ON DELETE: Restrict

FK_BinhLuan_User: BinhLuan.TaiKhoanId â†’ User.Id
  ON DELETE: Restrict

FK_LienHe_User: LienHe.TaiKhoanId â†’ User.Id
  ON DELETE: Restrict

-- Indexes
IX_CauHoi_ChuDeId ON CauHoi(ChuDeId)
IX_DeThi_ChuDeId ON DeThi(ChuDeId)
IX_KetQuaThi_TaiKhoanId ON KetQuaThi(TaiKhoanId)
IX_KetQuaThi_DeThiId ON KetQuaThi(DeThiId)
```

---

## ğŸ¨ UI/UX DESIGN PATTERNS

### Material Design 3 Theme

```dart
Primary Color: #2196F3 (Blue)
Secondary Color: #4CAF50 (Green)
Error Color: #F44336 (Red)
Background: #FAFAFA (Light Grey)
Surface: #FFFFFF (White)

Design Size: 390x844 (iPhone 14 Pro)
Responsive: ScreenUtil with .w, .h, .sp, .r extensions
```

### Screen Layouts

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Common Layout Pattern:                  â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ AppBar                              â”‚ â”‚
â”‚ â”‚ - Title                             â”‚ â”‚
â”‚ â”‚ - Back button (if nested)           â”‚ â”‚
â”‚ â”‚ - Action buttons                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Body (SafeArea)                     â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ Responsive padding: 16.w, 20.w      â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ Scrollable content:                 â”‚ â”‚
â”‚ â”‚ - ListView                          â”‚ â”‚
â”‚ â”‚ - GridView                          â”‚ â”‚
â”‚ â”‚ - SingleChildScrollView             â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ Pull-to-refresh: RefreshIndicator   â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Bottom Navigation (if applicable)   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Card Design Pattern

```dart
Container(
  decoration: BoxDecoration(
    color: Colors.white,
    borderRadius: BorderRadius.circular(12.r),
    boxShadow: [
      BoxShadow(
        color: Colors.black.withValues(alpha: 0.05),
        blurRadius: 8-10,
        offset: Offset(0, 2),
      ),
    ],
  ),
  padding: EdgeInsets.all(16.w),
  child: [...content...]
)
```

### Button Styles

```dart
// Primary Action Button
ElevatedButton(
  style: ElevatedButton.styleFrom(
    backgroundColor: primary color,
    foregroundColor: white,
    elevation: 2-4,
    padding: EdgeInsets.symmetric(horizontal: 24.w, vertical: 12.h),
    shape: RoundedRectangleBorder(
      borderRadius: BorderRadius.circular(12.r),
    ),
  ),
  child: Text,
)

// Secondary Action Button
OutlinedButton(
  style: OutlinedButton.styleFrom(
    side: BorderSide(color: primary, width: 1.5),
    padding: EdgeInsets.symmetric(horizontal: 24.w, vertical: 12.h),
  ),
  child: Text,
)

// Action Button with Gradient
Container with gradient + Material + InkWell
```

---

## ğŸš€ DEPLOYMENT & CONFIGURATION

### Backend Configuration

```json
// appsettings.json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=...;Database=...;User Id=...;Password=...;"
  },
  "Jwt": {
    "Key": "your-secret-key-min-32-chars",
    "Issuer": "ThiTracNghiemApi",
    "Audience": "ThiTracNghiemApp",
    "ExpireMinutes": 60
  },
  "Smtp": {
    "Host": "smtp.gmail.com",
    "Port": 587,
    "Username": "your-email@gmail.com",
    "Password": "app-password",
    "FromEmail": "your-email@gmail.com",
    "FromName": "Smart Test System"
  },
  "GoogleAuth": {
    "ClientId": "your-google-client-id.apps.googleusercontent.com"
  }
}
```

### Frontend Configuration

```bash
# .env file
BASE_URL=http://10.0.2.2:5000
GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
```

### Build Commands

```bash
# Backend
cd ThiTracNghiemApi
dotnet restore
dotnet ef database update
dotnet run

# Frontend
cd thitracnghiemapp
flutter pub get
flutter run

# Production builds
flutter build apk --release
flutter build ios --release
flutter build web --release
```

---

## ğŸ“Š API ENDPOINTS SUMMARY

### Authentication
```
POST   /auth/register              - Register new user
POST   /auth/login                 - Login with username/password
POST   /auth/google                - Login with Google
POST   /auth/verify-2fa            - Verify 2FA code
POST   /auth/resend-2fa            - Resend 2FA code
POST   /auth/forgot-password       - Request password reset
POST   /auth/reset-password        - Reset password with token
GET    /auth/profile               - Get current user profile
PUT    /auth/profile               - Update profile
POST   /auth/change-password       - Change password
POST   /auth/enable-2fa            - Enable 2FA
POST   /auth/disable-2fa           - Disable 2FA
```

### Topics (Chá»§ Ä‘á»)
```
GET    /chu-de                     - Get all topics
GET    /chu-de/{id}                - Get topic by ID
POST   /chu-de                     - Create topic [Admin]
PUT    /chu-de/{id}                - Update topic [Admin]
DELETE /chu-de/{id}                - Delete topic [Admin]
```

### Questions (CÃ¢u há»i)
```
GET    /cau-hoi                    - Get questions (with filters)
GET    /cau-hoi/{id}               - Get question by ID
POST   /cau-hoi                    - Create question [Admin]
POST   /cau-hoi/import-excel       - Import from Excel [Admin]
PUT    /cau-hoi/{id}               - Update question [Admin]
DELETE /cau-hoi/{id}               - Delete question [Admin]
```

### Exams (Äá» thi)
```
GET    /de-thi                     - Get open exams (or all for admin)
GET    /de-thi/{id}                - Get exam by ID
POST   /de-thi                     - Create exam [Admin]
PUT    /de-thi/{id}                - Update exam [Admin]
DELETE /de-thi/{id}                - Delete exam [Admin]
```

### Taking Exam (Thi)
```
POST   /thi/bat-dau                - Start exam session
POST   /thi/nop-bai                - Submit exam
```

### Results (Káº¿t quáº£ thi)
```
GET    /ket-qua-thi                - Get my results
GET    /ket-qua-thi/{id}           - Get result by ID
GET    /ket-qua-thi/{id}/chi-tiet  - Get detailed answers
GET    /ket-qua-thi/thong-ke       - Get statistics
```

### Comments (BÃ¬nh luáº­n)
```
GET    /binh-luan                  - Get comments (with filters)
POST   /binh-luan                  - Create comment
PUT    /binh-luan/{id}             - Update comment
DELETE /binh-luan/{id}             - Delete comment
```

### Contact (LiÃªn há»‡)
```
POST   /lien-he                    - Send contact message
GET    /lien-he/admin              - Get all messages [Admin]
DELETE /lien-he/{id}               - Delete message [Admin]
```

### User Management (Admin only)
```
GET    /users                      - Get users (paginated, search)
GET    /users/{id}                 - Get user by ID
POST   /users                      - Create user
PATCH  /users/{id}/roles           - Update roles
PATCH  /users/{id}/lock            - Lock/unlock user
DELETE /users/{id}                 - Delete user
```

---

## ğŸ”§ TROUBLESHOOTING

### Common Issues

1. **"Cannot connect to API"**
   - Check BASE_URL in .env
   - Android emulator: use 10.0.2.2 instead of localhost
   - iOS simulator: use localhost or real IP
   - Check backend is running

2. **"Unauthorized" after login**
   - Token expired, re-login
   - Clear app data
   - Check JWT configuration matches

3. **Images not loading**
   - Run `flutter pub get` after adding to assets
   - Check pubspec.yaml assets section
   - Hot restart (not hot reload)

4. **Database errors**
   - Run `dotnet ef database update`
   - Check connection string
   - Ensure SQL Server is running

5. **Google login not working**
   - Check GOOGLE_CLIENT_ID in both frontend and backend
   - Verify OAuth consent screen configured
   - Check SHA-1 fingerprint for Android

---

## ğŸ“ DEVELOPMENT BEST PRACTICES

### Code Organization
- Follow SOLID principles
- Use async/await for all API calls
- Handle errors gracefully with try-catch
- Show loading states during async operations
- Provide user feedback (SnackBar, Dialog)

### State Management
- Use Provider for global state
- Keep UI widgets stateless when possible
- Call notifyListeners() after state changes
- Dispose controllers and listeners

### API Design
- RESTful conventions
- Consistent error responses
- Paginate large datasets
- Use DTOs for data transfer
- Validate inputs server-side

### Security
- Never store sensitive data in plain text
- Use HTTPS in production
- Validate JWT on every protected endpoint
- Sanitize user inputs
- Implement rate limiting

### Testing
- Unit tests for business logic
- Integration tests for API endpoints
- Widget tests for UI components
- Test error handling paths

---

## ğŸ“š DEPENDENCIES

### Backend
```xml
<PackageReference Include="Microsoft.AspNetCore.Authentication.JwtBearer" Version="9.0.0" />
<PackageReference Include="Microsoft.AspNetCore.Identity.EntityFrameworkCore" Version="9.0.0" />
<PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer" Version="9.0.0" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="9.0.0" />
<PackageReference Include="EPPlus" Version="7.5.2" /> <!-- Excel import -->
<PackageReference Include="Google.Apis.Auth" Version="1.68.0" /> <!-- Google OAuth -->
```

### Frontend
```yaml
dependencies:
  flutter:
    sdk: flutter
  provider: ^6.1.5+1          # State management
  http: ^1.5.0                # HTTP client
  flutter_secure_storage: ^9.2.4  # Secure storage
  flutter_screenutil: ^5.9.3  # Responsive UI
  google_sign_in: ^6.2.1      # Google OAuth
  google_fonts: ^6.2.1        # Fonts
  cached_network_image: ^3.4.1  # Image caching
  file_picker: ^10.3.3        # File picker
  intl: ^0.20.2               # Internationalization
  fl_chart: ^0.69.0           # Charts
  qr_flutter: ^4.1.0          # QR codes
  flutter_dotenv: ^6.0.0      # Environment variables
```

---

## ğŸ¯ FUTURE ENHANCEMENTS

1. **Real-time features**
   - Live leaderboard during exams
   - Chat support with admin
   - Push notifications

2. **Advanced exam features**
   - Question shuffling
   - Answer shuffling
   - Essay questions (manual grading)
   - Image/audio questions
   - Detailed analytics

3. **Gamification**
   - Badges and achievements
   - Point system
   - User rankings
   - Study streaks

4. **Admin features**
   - Bulk operations
   - Advanced analytics dashboard
   - Export reports (PDF, Excel)
   - Email notifications

5. **Performance**
   - Caching strategies
   - Lazy loading
   - Database indexing optimization
   - CDN for static assets

---

**Document Version**: 1.0  
**Last Updated**: October 31, 2025  
**Author**: Development Team  
**Project**: Smart Test - Há»‡ thá»‘ng thi tráº¯c nghiá»‡m thÃ´ng minh
